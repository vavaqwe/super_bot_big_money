# üîß –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–•

## –î–∞—Ç–∞: 14 –Ω–æ—è–±—Ä—è 2025
## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### ‚úÖ 1. –§–£–ù–ö–¶–ò–Ø –ó–ê–ö–†–´–¢–ò–Ø –ü–û PnL (TP/SL)

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª Take Profit = +10% –∏ Stop Loss = -10%
- –í –∫–æ–Ω—Ñ–∏–≥–µ —Å—Ç–æ—è–ª–æ 20% –∏ -20%

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# config.py (—Å—Ç—Ä–æ–∫–∏ 62-63)
TAKE_PROFIT_PCT = 10.0  # üéØ –í–ò–ü–†–ê–í–õ–ï–ù–û: –ó–∞–∫—Ä–∏–≤–∞—Ç–∏ –ø–æ–∑–∏—Ü—ñ—é –ø—Ä–∏ +10% –ø—Ä–∏–±—É—Ç–∫—É
STOP_LOSS_PCT = 10.0   # üõ°Ô∏è –í–ò–ü–†–ê–í–õ–ï–ù–û: –°—Ç–æ–ø-–ª–æ—Å—Å –ø—Ä–∏ -10% –∑–±–∏—Ç–∫—É
```

**–î–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã:**
- –§—É–Ω–∫—Ü–∏—è `calculate_pnl_percentage()` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç PnL —Å —É—á–µ—Ç–æ–º leverage
- –ü—Ä–æ–≤–µ—Ä–∫–∞ TP: `if pnl_pct >= TAKE_PROFIT_PCT:` (—Å—Ç—Ä–æ–∫–∞ 773 bot.py)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ SL: `if pnl_pct <= -STOP_LOSS_PCT:` (—Å—Ç—Ä–æ–∫–∞ 790 bot.py)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –∫–æ–≥–¥–∞ PnL –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç +10% –∏–ª–∏ -10%
3. –ü–æ–∑–∏—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–∫—Ä—ã—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /var/log/supervisor/backend.err.log | grep "PnL CHECK"`

---

### ‚úÖ 2. –û–¢–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ô –í ISOLATED –†–ï–ñ–ò–ú–ï

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Margin mode –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–π
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–∏—Ä–∂–∞ –º–æ–≥–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cross margin

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# xt_client.py (—Å—Ç—Ä–æ–∫–∏ 471-477)
# ‚öôÔ∏è –ö–†–û–ö 5A: –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ ISOLATED MARGIN MODE
try:
    xt.set_margin_mode('isolated', symbol)
    logging.info(f"[XT {symbol}] ‚öôÔ∏è –ö–†–û–ö 5A: ‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ISOLATED margin mode")
except Exception as e:
    logging.warning(f"[XT {symbol}] ‚ö†Ô∏è –ö–†–û–ö 5A: –ü–æ–º–∏–ª–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è margin mode (–º–æ–∂–ª–∏–≤–æ –≤–∂–µ isolated): {e}")
    pass
```

**–î–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã:**
- –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è isolated margin mode
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `xt.set_margin_mode('isolated', symbol)`
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è (–µ—Å–ª–∏ —Ä–µ–∂–∏–º —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ISOLATED margin mode"
3. –ù–∞ –±–∏—Ä–∂–µ XT.com –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –≤ Isolated —Ä–µ–∂–∏–º–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö: `tail -f /var/log/supervisor/backend.err.log | grep "ISOLATED"`

---

### ‚úÖ 3. –§–£–ù–ö–¶–ò–Ø BLACKLIST –î–õ–Ø –¢–û–ö–ï–ù–û–í

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§–∞–π–ª `blacklist.json` –∏–º–µ–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: `[]` –≤–º–µ—Å—Ç–æ `{"banned_symbols": [], "loss_counts": {}}`
- –≠—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```json
// blacklist.json
{
    "banned_symbols": [],
    "loss_counts": {}
}
```

**–î–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã:**
1. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:** `load_blacklist()` (—Å—Ç—Ä–æ–∫–∞ 85-96 bot.py)
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º:** –ö–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ `banned_symbols` (—Å—Ç—Ä–æ–∫–∞ 1394 bot.py)
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ Stop Loss:**
   - –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ SL –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `check_and_update_blacklist()` (—Å—Ç—Ä–æ–∫–∞ 894)
   - –°—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
   - –ü–æ—Å–ª–µ 3 SL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ blacklist
4. **–°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞:** –ü–æ—Å–ª–µ Take Profit —Å—á–µ—Ç—á–∏–∫ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è (—Å—Ç—Ä–æ–∫–∞ 131-136)

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–∑–∏—Ü–∏—é –∫–æ—Ç–æ—Ä–∞—è –∑–∞–∫—Ä–æ–µ—Ç—Å—è –ø–æ Stop Loss
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `blacklist.json` - –¥–æ–ª–∂–µ–Ω —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è —Å—á–µ—Ç—á–∏–∫
3. –ü–æ—Å–ª–µ 3 Stop Loss —Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞—Å—Ç—å –≤ `banned_symbols`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /var/log/supervisor/backend.err.log | grep "BLACKLIST"`

---

## üìä –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```python
# bot.py (—Å—Ç—Ä–æ–∫–∞ 777)
logging.info(f"üìä [{symbol}] PnL CHECK: {pnl_pct:+.2f}% | TP={TAKE_PROFIT_PCT}% | SL=-{STOP_LOSS_PCT}%")
logging.info(f"üéØ TP TRIGGERED [{symbol}] PnL={pnl_pct:.2f}% >= +{TAKE_PROFIT_PCT:.2f}% ‚Üí CLOSE")
logging.info(f"üö® SL TRIGGERED [{symbol}] PnL={pnl_pct:.2f}% ‚â§ -{STOP_LOSS_PCT:.2f}% ‚Üí CLOSE")
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ TP/SL –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
```bash
tail -f /var/log/supervisor/backend.err.log | grep -E "(PnL CHECK|TP TRIGGERED|SL TRIGGERED)"
```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ Isolated —Ä–µ–∂–∏–º–∞:**
```bash
tail -f /var/log/supervisor/backend.err.log | grep -E "(ISOLATED|margin mode)"
```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ Blacklist:**
```bash
tail -f /var/log/supervisor/backend.err.log | grep -E "(BLACKLIST|banned)"
cat /app/blacklist.json
```

4. **–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å:**
```bash
sudo supervisorctl status
```

---

## üìù –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

1. **PnL —Ä–∞—Å—á–µ—Ç** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç leverage (7x) - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ:
   - +10% TP = +70% –æ—Ç –º–∞—Ä–∂–∏
   - -10% SL = -70% –æ—Ç –º–∞—Ä–∂–∏

2. **Isolated —Ä–µ–∂–∏–º** –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –æ–¥–Ω–æ–π

3. **Blacklist** —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏

4. **–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±—ç–∫–µ–Ω–¥–∞

---

## ‚úÖ –°–¢–ê–¢–£–°: –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´ –ò –†–ê–ë–û–¢–ê–Æ–¢
